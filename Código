#include <Wire.h>
#include <Adafruit_ADS1X15.h>
Adafruit_ADS1115 ads1115; // construct an ads1115 at address 0x48
#define power_pin 5 //pin para alimentar el sensor de salinidad
#define channelValue 0
int16_t digitals, digitalt;
int16_t adc0;
int16_t adc1;
int16_t adc2;
int16_t adc3;
int16_t averageSample;
float temperatura=adc0;
const int AirValue =30304;  // Medimos valor en seco
const int WaterValue =15300;  // Medimos valor en agua
 
int sensor_humedad(){
  adc0 = ads1115.readADC_SingleEnded(0);
  int humedad = 100*AirValue/(AirValue-WaterValue)-adc0*100/(AirValue-WaterValue);
 
  Serial.print("Porcentaje de humedad: ");
  Serial.print(humedad);
  Serial.println("%");
  Serial.println("");
  Serial.println("---------------------------------");
  Serial.println("");
  delay(100);

  return humedad;
}

int sensor_temp(){
  adc2 = ads1115.readADC_SingleEnded(1);
  int tem = map(adc2, 6700, 10320, 20, 37);
  Serial.print("Temperatura: ");
  Serial.print(tem);
  Serial.println(" grados");
  Serial.println("");
  Serial.println("---------------------------------");
  Serial.println("");
  delay(100);

  return tem;
}

int sensor_luz(){
  adc3 = ads1115.readADC_SingleEnded(2);
  Serial.println("Iluminacion.");
  Serial.println("");
  Serial.print("Intensa iluminacion: ");
  int alto = map(adc3,11,30000,0,100);
  Serial.print(alto);
  Serial.println(" %");
  Serial.println("");
  Serial.print("Debil iluminacion: ");
  if(adc3 > 100){
    adc3 = 100;
  }
  int bajo = map(adc3,11,100,0,100);
  Serial.print(bajo);
  Serial.println(" %");
  Serial.println("");
  Serial.println("---------------------------------");
  Serial.println("");
  delay(100);

  return alto;
}

int sensor_salinidad(){
  adc1 = analogRead(A0);  
  digitalWrite(power_pin, HIGH);
  int sal = map(adc1,12,0,0,100);
  delay(100);
  digitalWrite(power_pin, LOW);
  delay(100);
  Serial.print("Salinidad: ");
  Serial.print(sal, DEC);
  Serial.println(" g/L");
  Serial.println("");
  Serial.println("---------------------------------");
  Serial.println("");

  return sal;
}

void condiciones(){
  int humedad_maíz = 66;
  int iluminación_maíz = 46;
  int temperatura_maíz = 31;
  int salinidad_maíz = 4;
  int ph_maíz = 6;
  int condiciones = (abs(humedad_maíz-sensor_humedad())+abs(iluminación_maíz-sensor_luz())+abs(temperatura_maíz-sensor_temp())+abs(salinidad_maíz-sensor_salinidad())); //Luego se añadirá el ph
  int prosperidad = 2500/condiciones;
  if (condiciones < 50){
    prosperidad = -condiciones + 100;
  }
  Serial.println("Porcentaje de optimización para una cosecha de MAIZ.");
  Serial.println("Este porcentaje recoge la informacion del ambiente en el que se encuentra la planta y refleja que tan bueno es.");
  Serial.print("Prosperidad: ");
  Serial.print(prosperidad);
  Serial.println("%");
  Serial.println("");
  Serial.println("---------------------------------");
  Serial.println("");
}

void setup() { 
  Serial.begin(9600);
  pinMode(power_pin,OUTPUT );
  Serial.println("Ajustando la ganancia...");
  ads1115.setGain(GAIN_ONE);
  Serial.println("Inicializando...");
  ads1115.begin(0x48); //Initialize ads1115
  Serial.println("Inicializando el medidor de Humedad");
  Serial.println("Inicializando el medidor de Salinidad");
  Serial.println("Inicializando el medidor de Temperatura");
  Serial.println("Inicializando el medidor de Luminosidad");
  Serial.println("Ajustando la ganancia...");
  ads1115.setGain(GAIN_ONE);
  Serial.println("Rango del ADC: +/- 4.096V (1 bit=2mV)");
}
 
void loop() {
  sensor_humedad();
  sensor_salinidad();
  sensor_temp();
  sensor_luz();
  condiciones();
  delay (6000);
}
